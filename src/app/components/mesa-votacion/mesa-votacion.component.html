<div *ngIf="mostrarUnirseOverlay" class="overlay-unirse">
  <app-unirse-partida (cerrar)="cerrarOverlay()"></app-unirse-partida>
</div>

<div class="fondo-translucido">
  <div class="acciones">
    <div class="link-invitacion">
      <label>Invitar participantes:</label>
      <input type="text" [value]="linkDeInvitacion" readonly />
      <button (click)="copiarAlPortapapeles()">Copiar Link</button>
    </div>
  </div>

  <header>
    <h1>Mesa de Votación</h1>
    <div class="nombre-partida-header">
      Partida: <strong>{{ nombrePartida || 'Sin nombre' }}</strong>
    </div>
  </header>

  <section class="mesa-scroll">
    <div class="jugadores-alrededor">
      <div *ngFor="let jugador of jugadores" class="jugador" [ngClass]="{ 'espectador': jugador.modo === 'espectador' }">
        <img
          class="avatar"
          [src]="jugador.avatarUrl || 'assets/avatars/logo1.jpg'"
          alt="Avatar de {{ jugador.nombre }}"
          (error)="jugador.avatarUrl = 'assets/avatars/logo1.jpg'"
        />
        <div class="nombre">{{ jugador.nombre }}</div>
        <div class="carta"
             [ngClass]="{
               'oculta': !jugador.carta && jugador.modo !== 'espectador',
               'espectador-carta': jugador.modo === 'espectador'
             }">
          <ng-container *ngIf="cartasReveladas || jugador.modo === 'espectador'; else cartaOculta">
            <span *ngIf="jugador.modo !== 'espectador'; else cartaEspectador">{{ jugador.carta ?? '—' }}</span>
          </ng-container>
          <ng-template #cartaOculta><span class="icono-oculto"></span></ng-template>
          <ng-template #cartaEspectador><span class="icono-oculto">🎥</span></ng-template>
        </div>
      </div>
    </div>
  </section>

  <section class="acciones">
    <ng-container *ngIf="usuarioAdministrador">

      <!-- Botones de control (solo si es admin o espectador) -->
      <div *ngIf="usuarioAdministrador.modo !== 'espectador'" class="botones-admin animar">
        <button class="boton-next" (click)="siguienteRonda()">Siguiente Ronda →</button>
        <button *ngIf="cartasReveladas" class="boton-next cerrar" (click)="cerrarRevelacion()">Ocultar Cartas 🙈</button>
        <button *ngIf="!cartasReveladas" class="boton-next" (click)="revelarCartas()">Revelar Cartas 👀</button>
      </div>

      <!-- Mensaje si es espectador -->
      <div *ngIf="usuarioAdministrador.modo === 'espectador'" class="mensaje-error">
        Estás en modo espectador. No puedes elegir cartas.
      </div>

    </ng-container>
  </section>

  <section *ngIf="cartasReveladas" class="resultados">
    <h3>Resultados</h3>
    <div *ngIf="promedioVotos === 0" class="mensaje-sin-votos animacion-votos">
      <span class="emoji">😴</span>
      Nadie ha votado todavía.
    </div>
    <ul *ngIf="promedioVotos > 0">
      <li *ngFor="let carta of cartasConVotos">
        Carta {{ carta }}: {{ votosPorCarta[carta] }} voto(s)
      </li>
    </ul>
  </section>
</div>
